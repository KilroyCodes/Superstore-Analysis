<html>
<head>
<title>superstore-data-analysis.ipynb</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #bcbec4;}
.s1 { color: #cf8e6d;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #7a7e85;}
.s5 { color: #2aacb8;}
.ls0 { height: 1px; border-width: 0; color: #43454a; background-color:#43454a}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
superstore-data-analysis.ipynb</font>
</center></td></tr></table>
<pre><span class="s0">#%% md 
**Background** 
 
This code utilises imaginary data from a 'Superstore' which sells various kinds of products (furniture, tech goods, etc) to different customer segments (consumer, corporate, home office). 
 
The data details separate customer orders, including products ordered, profit, discount applied, and customer geography. 
 
**Goals of this Analysis** 
 
In this analysis, we will assume our target audience are the key stakeholders of the business (e.g., owners, operations management). 
 
To help them understand how the business is performing, we will present high level KPI figures (e.g., Profit), and then further break down those figures into different segments (e.g., Profit by Product Sub-Category). This will help guide business decisions around which areas are most and least profitable, and if current strategies need to be re-examined. <hr class="ls0">#%% md 
### Data Load In <hr class="ls0">#%% 
</span><span class="s1">import </span><span class="s0">pandas </span><span class="s1">as </span><span class="s0">pd</span>
<span class="s1">import </span><span class="s0">seaborn </span><span class="s1">as </span><span class="s0">sns</span>
<span class="s1">import </span><span class="s0">matplotlib</span><span class="s2">.</span><span class="s0">pyplot </span><span class="s1">as </span><span class="s0">plt</span>
<span class="s1">import </span><span class="s0">matplotlib</span><span class="s2">.</span><span class="s0">ticker </span><span class="s1">as </span><span class="s0">mtick</span>
<span class="s1">from </span><span class="s0">pandas </span><span class="s1">import </span><span class="s0">pivot_table</span><hr class="ls0"><span class="s0">#%% 
df </span><span class="s2">= </span><span class="s0">pd</span><span class="s2">.</span><span class="s0">read_csv</span><span class="s2">(</span><span class="s3">&quot;Sample - Superstore.csv&quot;</span><span class="s2">, </span><span class="s0">encoding</span><span class="s2">=</span><span class="s3">'windows-1254'</span><span class="s2">)</span>
<span class="s0">df</span><span class="s2">.</span><span class="s0">head</span><span class="s2">()</span><hr class="ls0"><span class="s0">#%% md 
### Data First Look <hr class="ls0">#%% 
df</span><span class="s2">.</span><span class="s0">shape</span><hr class="ls0"><span class="s0">#%% 
df</span><span class="s2">.</span><span class="s0">describe</span><span class="s2">()</span>
<span class="s4">#Value of note: highly negative minimum profit value</span><hr class="ls0"><span class="s0">#%% 
df</span><span class="s2">.</span><span class="s0">loc</span><span class="s2">[</span><span class="s0">df</span><span class="s2">[</span><span class="s3">'Profit'</span><span class="s2">].</span><span class="s0">idxmin</span><span class="s2">()]</span>
<span class="s4"># Large loss due to discounting under cost -- review discount structure and strategy</span><hr class="ls0"><span class="s0">#%% md 
### Data Cleaning <hr class="ls0">#%% md 
#### Check for null values <hr class="ls0">#%% 
df</span><span class="s2">.</span><span class="s0">isnull</span><span class="s2">().</span><span class="s0">sum</span><span class="s2">()</span><hr class="ls0"><span class="s0">#%% md 
#### Remove duplicate rows *(if applicable)* <hr class="ls0">#%% 
</span><span class="s4">#Check for duplicates</span>
<span class="s0">print</span><span class="s2">(</span><span class="s0">df</span><span class="s2">.</span><span class="s0">duplicated</span><span class="s2">().</span><span class="s0">sum</span><span class="s2">())</span><hr class="ls0"><span class="s0">#%% 
</span><span class="s4"># Although no duplicates, running drop function for future data updates</span>
<span class="s0">df</span><span class="s2">.</span><span class="s0">drop_duplicates</span><span class="s2">()</span><hr class="ls0"><span class="s0">#%% 
</span><span class="s4"># Resulting dataset size</span>
<span class="s0">df</span><span class="s2">.</span><span class="s0">shape</span><hr class="ls0"><span class="s0">#%% md 
#### Data Reformatting and Addition of New Useful Columns <hr class="ls0">#%% 
</span><span class="s4"># Check data types currently</span>
<span class="s0">df</span><span class="s2">.</span><span class="s0">dtypes</span><hr class="ls0"><span class="s0">#%% md 
Dates are object type; Should convert to datetime <hr class="ls0">#%% 
df</span><span class="s2">[</span><span class="s3">'Order Date'</span><span class="s2">] = </span><span class="s0">pd</span><span class="s2">.</span><span class="s0">to_datetime</span><span class="s2">(</span><span class="s0">df</span><span class="s2">[</span><span class="s3">'Order Date'</span><span class="s2">], </span><span class="s0">format</span><span class="s2">=</span><span class="s3">'%m/%d/%Y'</span><span class="s2">)</span>
<span class="s0">df</span><span class="s2">[</span><span class="s3">'Ship Date'</span><span class="s2">] = </span><span class="s0">pd</span><span class="s2">.</span><span class="s0">to_datetime</span><span class="s2">(</span><span class="s0">df</span><span class="s2">[</span><span class="s3">'Ship Date'</span><span class="s2">], </span><span class="s0">format</span><span class="s2">=</span><span class="s3">'%m/%d/%Y'</span><span class="s2">)</span><hr class="ls0"><span class="s0">#%% md 
New columns: 
1. Margin Ratio (Profit / Sales) 
2. Year-Month (YYYY-MM) 
3. Month (MM) 
4. Year (YYYY) <hr class="ls0">#%% 
df</span><span class="s2">[</span><span class="s3">'Margin Ratio'</span><span class="s2">]=</span><span class="s0">df</span><span class="s2">[</span><span class="s3">'Profit'</span><span class="s2">]/</span><span class="s0">df</span><span class="s2">[</span><span class="s3">'Sales'</span><span class="s2">]</span>

<span class="s0">df</span><span class="s2">[</span><span class="s3">'Year-Month'</span><span class="s2">]=</span><span class="s0">df</span><span class="s2">[</span><span class="s3">'Order Date'</span><span class="s2">].</span><span class="s0">dt</span><span class="s2">.</span><span class="s0">to_period</span><span class="s2">(</span><span class="s3">'M'</span><span class="s2">)</span>
<span class="s0">df</span><span class="s2">[</span><span class="s3">'Month'</span><span class="s2">]=</span><span class="s0">df</span><span class="s2">[</span><span class="s3">'Order Date'</span><span class="s2">].</span><span class="s0">dt</span><span class="s2">.</span><span class="s0">month</span>
<span class="s0">df</span><span class="s2">[</span><span class="s3">'Year'</span><span class="s2">]=</span><span class="s0">df</span><span class="s2">[</span><span class="s3">'Order Date'</span><span class="s2">].</span><span class="s0">dt</span><span class="s2">.</span><span class="s0">year</span><hr class="ls0"><span class="s0">#%% 
df</span><span class="s2">.</span><span class="s0">head</span><span class="s2">()</span><hr class="ls0"><span class="s0">#%% 
</span><span class="s4"># Sub-dataframes for current and previous years</span>
<span class="s0">current_year </span><span class="s2">= </span><span class="s0">df</span><span class="s2">[</span><span class="s3">'Year'</span><span class="s2">].</span><span class="s0">max</span><span class="s2">()</span>
<span class="s0">df_current_year </span><span class="s2">= </span><span class="s0">df</span><span class="s2">[</span><span class="s0">df</span><span class="s2">[</span><span class="s3">'Year'</span><span class="s2">] == </span><span class="s0">current_year</span><span class="s2">]</span>

<span class="s0">previous_year </span><span class="s2">= (</span><span class="s0">df</span><span class="s2">[</span><span class="s3">'Year'</span><span class="s2">].</span><span class="s0">max</span><span class="s2">())-</span><span class="s5">1</span>
<span class="s0">df_previous_year </span><span class="s2">= </span><span class="s0">df</span><span class="s2">[</span><span class="s0">df</span><span class="s2">[</span><span class="s3">'Year'</span><span class="s2">] == </span><span class="s0">previous_year</span><span class="s2">]</span>
<span class="s0">df_past_2_years </span><span class="s2">= </span><span class="s0">df</span><span class="s2">[</span><span class="s0">df</span><span class="s2">[</span><span class="s3">'Year'</span><span class="s2">] &gt;= </span><span class="s0">previous_year</span><span class="s2">]</span><hr class="ls0"><span class="s0">#%% md 
### Data Analysis <hr class="ls0">#%% md 
#### KPIs <hr class="ls0">#%% md 
##### Yearly KPIs <hr class="ls0">#%% 
Year_Revenue </span><span class="s2">= </span><span class="s0">df_current_year</span><span class="s2">[</span><span class="s3">'Sales'</span><span class="s2">].</span><span class="s0">sum</span><span class="s2">()</span>
<span class="s0">Year_Profit </span><span class="s2">= </span><span class="s0">df_current_year</span><span class="s2">[</span><span class="s3">'Profit'</span><span class="s2">].</span><span class="s0">sum</span><span class="s2">()</span>
<span class="s0">Year_Profit_Margin </span><span class="s2">= (</span><span class="s0">Year_Profit </span><span class="s2">/ </span><span class="s0">Year_Revenue</span><span class="s2">)*</span><span class="s5">100</span>
<span class="s0">Year_Order_Count </span><span class="s2">= </span><span class="s0">df_current_year</span><span class="s2">[</span><span class="s3">'Order ID'</span><span class="s2">].</span><span class="s0">count</span><span class="s2">()</span>
<span class="s0">Year_Discounted_Order_Count </span><span class="s2">= (</span><span class="s0">df_current_year</span><span class="s2">[</span><span class="s3">'Discount'</span><span class="s2">]&gt;</span><span class="s5">0</span><span class="s2">).</span><span class="s0">sum</span><span class="s2">()</span>

<span class="s0">scp </span><span class="s2">= </span><span class="s0">df</span><span class="s2">.</span><span class="s0">groupby</span><span class="s2">([</span><span class="s3">'Sub-Category'</span><span class="s2">])[</span><span class="s3">'Profit'</span><span class="s2">].</span><span class="s0">sum</span><span class="s2">().</span><span class="s0">reset_index</span><span class="s2">()</span>
<span class="s0">Year_Max_Profitable_Category </span><span class="s2">= </span><span class="s0">scp</span><span class="s2">.</span><span class="s0">loc</span><span class="s2">[</span><span class="s0">scp</span><span class="s2">[</span><span class="s3">'Profit'</span><span class="s2">].</span><span class="s0">idxmax</span><span class="s2">()].</span><span class="s0">iloc</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]</span>
<span class="s0">Year_Category_Profit </span><span class="s2">= </span><span class="s0">scp</span><span class="s2">.</span><span class="s0">loc</span><span class="s2">[</span><span class="s0">scp</span><span class="s2">[</span><span class="s3">'Profit'</span><span class="s2">].</span><span class="s0">idxmax</span><span class="s2">()].</span><span class="s0">iloc</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]</span>

<span class="s0">print</span><span class="s2">(</span><span class="s3">f&quot;Current Year: </span><span class="s1">{</span><span class="s0">current_year</span><span class="s1">} \n</span><span class="s3">&quot;</span>
      <span class="s3">f&quot;Total Revenue: $</span><span class="s1">{</span><span class="s0">Year_Revenue</span><span class="s1">:</span><span class="s3">,.2f</span><span class="s1">} \n</span><span class="s3">&quot;</span>
      <span class="s3">f&quot;Total Profit: $</span><span class="s1">{</span><span class="s0">Year_Profit</span><span class="s1">:</span><span class="s3">,.2f</span><span class="s1">} \n</span><span class="s3">&quot;</span>
      <span class="s3">f&quot;Profit Margin: </span><span class="s1">{</span><span class="s0">Year_Profit_Margin</span><span class="s1">:</span><span class="s3">,.2f</span><span class="s1">}</span><span class="s3">% </span><span class="s1">\n</span><span class="s3">&quot;</span>
      <span class="s3">f&quot;Total Order Count: </span><span class="s1">{</span><span class="s0">Year_Order_Count</span><span class="s1">} \n \n</span><span class="s3">&quot;</span>
      <span class="s3">f&quot;Discounted Order Count: </span><span class="s1">{</span><span class="s0">Year_Discounted_Order_Count</span><span class="s1">} \n</span><span class="s3">&quot;</span>
      <span class="s3">f&quot;Most Profitable Category: </span><span class="s1">{</span><span class="s0">Year_Max_Profitable_Category</span><span class="s1">} \n</span><span class="s3">&quot;</span>
      <span class="s3">f&quot;Category Profit: $</span><span class="s1">{</span><span class="s0">Year_Category_Profit</span><span class="s1">:</span><span class="s3">,.2f</span><span class="s1">} \n</span><span class="s3">&quot;</span><span class="s2">)</span><hr class="ls0"><span class="s0">#%% md 
##### YoY Change <hr class="ls0">#%% 
PYear_Revenue </span><span class="s2">= </span><span class="s0">df_previous_year</span><span class="s2">[</span><span class="s3">'Sales'</span><span class="s2">].</span><span class="s0">sum</span><span class="s2">()</span>
<span class="s0">PYear_Profit </span><span class="s2">= </span><span class="s0">df_previous_year</span><span class="s2">[</span><span class="s3">'Profit'</span><span class="s2">].</span><span class="s0">sum</span><span class="s2">()</span>
<span class="s0">PYear_Profit_Margin </span><span class="s2">= (</span><span class="s0">PYear_Profit </span><span class="s2">/ </span><span class="s0">PYear_Revenue</span><span class="s2">)*</span><span class="s5">100</span>
<span class="s0">PYear_Order_Count </span><span class="s2">= </span><span class="s0">df_previous_year</span><span class="s2">[</span><span class="s3">'Order ID'</span><span class="s2">].</span><span class="s0">nunique</span><span class="s2">()</span>
<span class="s0">PYear_Discounted_Order_Count </span><span class="s2">= (</span><span class="s0">df_previous_year</span><span class="s2">[</span><span class="s3">'Discount'</span><span class="s2">]&gt;</span><span class="s5">0</span><span class="s2">).</span><span class="s0">sum</span><span class="s2">()</span>

<span class="s0">scp </span><span class="s2">= </span><span class="s0">df_previous_year</span><span class="s2">.</span><span class="s0">groupby</span><span class="s2">([</span><span class="s3">'Sub-Category'</span><span class="s2">])[</span><span class="s3">'Profit'</span><span class="s2">].</span><span class="s0">sum</span><span class="s2">().</span><span class="s0">reset_index</span><span class="s2">()</span>
<span class="s0">PYear_Max_Profitable_Category </span><span class="s2">= </span><span class="s0">scp</span><span class="s2">.</span><span class="s0">loc</span><span class="s2">[</span><span class="s0">scp</span><span class="s2">[</span><span class="s3">'Profit'</span><span class="s2">].</span><span class="s0">idxmax</span><span class="s2">()].</span><span class="s0">iloc</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]</span>
<span class="s0">PYear_Category_Profit </span><span class="s2">= </span><span class="s0">scp</span><span class="s2">.</span><span class="s0">loc</span><span class="s2">[</span><span class="s0">scp</span><span class="s2">[</span><span class="s3">'Profit'</span><span class="s2">].</span><span class="s0">idxmax</span><span class="s2">()].</span><span class="s0">iloc</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]</span>

<span class="s0">Revenue_Change </span><span class="s2">= (</span><span class="s0">Year_Revenue </span><span class="s2">- </span><span class="s0">PYear_Revenue</span><span class="s2">)/</span><span class="s0">PYear_Revenue</span><span class="s2">*</span><span class="s5">100</span>
<span class="s0">Profit_Change </span><span class="s2">= (</span><span class="s0">Year_Profit </span><span class="s2">- </span><span class="s0">PYear_Profit</span><span class="s2">)/</span><span class="s0">PYear_Profit</span><span class="s2">*</span><span class="s5">100</span>
<span class="s0">Profit_Margin_Change </span><span class="s2">= (</span><span class="s0">Year_Profit_Margin </span><span class="s2">- </span><span class="s0">PYear_Profit_Margin</span><span class="s2">)/</span><span class="s0">PYear_Profit_Margin</span><span class="s2">*</span><span class="s5">100</span>
<span class="s0">Order_Count_Change </span><span class="s2">= (</span><span class="s0">Year_Order_Count </span><span class="s2">- </span><span class="s0">PYear_Order_Count</span><span class="s2">)/</span><span class="s0">PYear_Order_Count</span><span class="s2">*</span><span class="s5">100</span>
<span class="s0">Discounted_Order_Count_Change </span><span class="s2">= (</span><span class="s0">Year_Discounted_Order_Count </span><span class="s2">- </span><span class="s0">PYear_Discounted_Order_Count</span><span class="s2">)/</span><span class="s0">PYear_Discounted_Order_Count</span><span class="s2">*</span><span class="s5">100</span>

<span class="s0">print</span><span class="s2">(</span><span class="s3">f&quot;YoY Revenue % Change: </span><span class="s1">{</span><span class="s0">Revenue_Change</span><span class="s1">:</span><span class="s3">,.2f</span><span class="s1">}</span><span class="s3">% </span><span class="s1">\n</span><span class="s3">&quot;</span>
      <span class="s3">f&quot;YoY Profit % Change: </span><span class="s1">{</span><span class="s0">Profit_Change</span><span class="s1">:</span><span class="s3">,.2f</span><span class="s1">}</span><span class="s3">% </span><span class="s1">\n</span><span class="s3">&quot;</span>
      <span class="s3">f&quot;YoY Profit Margin % Change: </span><span class="s1">{</span><span class="s0">Profit_Margin_Change</span><span class="s1">:</span><span class="s3">,.2f</span><span class="s1">}</span><span class="s3">% </span><span class="s1">\n</span><span class="s3">&quot;</span>
      <span class="s3">f&quot;YoY Order Count % Change: </span><span class="s1">{</span><span class="s0">Order_Count_Change</span><span class="s1">:</span><span class="s3">.2f</span><span class="s1">}</span><span class="s3">% </span><span class="s1">\n \n</span><span class="s3">&quot;</span>
      <span class="s3">f&quot;YoY Discounted Order Count Change: </span><span class="s1">{</span><span class="s0">Discounted_Order_Count_Change</span><span class="s1">:</span><span class="s3">,.2f</span><span class="s1">}</span><span class="s3">% </span><span class="s1">\n</span><span class="s3">&quot;</span>
      <span class="s3">f&quot;Previous Year Most Profitable Category: </span><span class="s1">{</span><span class="s0">PYear_Max_Profitable_Category</span><span class="s1">} \n</span><span class="s3">&quot;</span>
      <span class="s3">f&quot;Previous Year Category Profit: $</span><span class="s1">{</span><span class="s0">PYear_Category_Profit</span><span class="s1">:</span><span class="s3">,.2f</span><span class="s1">} \n</span><span class="s3">&quot;</span><span class="s2">)</span><hr class="ls0"><span class="s0">#%% md 
##### Revenue and Profit YoY (All Categories) <hr class="ls0">#%% 
fig</span><span class="s2">, </span><span class="s0">axes </span><span class="s2">= </span><span class="s0">plt</span><span class="s2">.</span><span class="s0">subplots</span><span class="s2">(</span><span class="s5">1</span><span class="s2">,</span><span class="s5">2</span><span class="s2">,</span><span class="s0">figsize</span><span class="s2">=(</span><span class="s5">20</span><span class="s2">,</span><span class="s5">7</span><span class="s2">),</span><span class="s0">constrained_layout</span><span class="s2">=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s0">sales_monthly </span><span class="s2">= </span><span class="s0">df_past_2_years</span><span class="s2">.</span><span class="s0">groupby</span><span class="s2">([</span><span class="s3">'Year'</span><span class="s2">,</span><span class="s3">'Month'</span><span class="s2">])[[</span><span class="s3">'Sales'</span><span class="s2">,</span><span class="s3">'Profit'</span><span class="s2">]].</span><span class="s0">sum</span><span class="s2">().</span><span class="s0">reset_index</span><span class="s2">()</span>

<span class="s0">axes</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s0">set_title</span><span class="s2">(</span><span class="s3">'Revenue MoM'</span><span class="s2">)</span>
<span class="s0">axes</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s0">set_ylabel</span><span class="s2">(</span><span class="s3">'Revenue'</span><span class="s2">)</span>
<span class="s0">sns</span><span class="s2">.</span><span class="s0">lineplot</span><span class="s2">(</span><span class="s0">data</span><span class="s2">=</span><span class="s0">sales_monthly</span><span class="s2">, </span><span class="s0">x</span><span class="s2">=</span><span class="s3">'Month'</span><span class="s2">, </span><span class="s0">y</span><span class="s2">=</span><span class="s3">'Sales'</span><span class="s2">, </span><span class="s0">hue</span><span class="s2">=</span><span class="s3">'Year'</span><span class="s2">, </span><span class="s0">palette</span><span class="s2">=[</span><span class="s3">'skyblue'</span><span class="s2">,</span><span class="s3">'red'</span><span class="s2">], </span><span class="s0">ax</span><span class="s2">=</span><span class="s0">axes</span><span class="s2">[</span><span class="s5">0</span><span class="s2">])</span>
<span class="s0">axes</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s0">legend</span><span class="s2">(</span><span class="s0">loc</span><span class="s2">=</span><span class="s3">'upper right'</span><span class="s2">)</span>

<span class="s0">axes</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s0">set_title</span><span class="s2">(</span><span class="s3">'Profit MoM'</span><span class="s2">)</span>
<span class="s0">axes</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s0">set_ylabel</span><span class="s2">(</span><span class="s3">'Profit'</span><span class="s2">)</span>
<span class="s0">sns</span><span class="s2">.</span><span class="s0">lineplot</span><span class="s2">(</span><span class="s0">data</span><span class="s2">=</span><span class="s0">sales_monthly</span><span class="s2">, </span><span class="s0">x</span><span class="s2">=</span><span class="s3">'Month'</span><span class="s2">, </span><span class="s0">y</span><span class="s2">=</span><span class="s3">'Profit'</span><span class="s2">, </span><span class="s0">hue</span><span class="s2">=</span><span class="s3">'Year'</span><span class="s2">, </span><span class="s0">palette</span><span class="s2">=[</span><span class="s3">'skyblue'</span><span class="s2">,</span><span class="s3">'red'</span><span class="s2">], </span><span class="s0">ax</span><span class="s2">=</span><span class="s0">axes</span><span class="s2">[</span><span class="s5">1</span><span class="s2">])</span>
<span class="s0">axes</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s0">legend</span><span class="s2">(</span><span class="s0">loc</span><span class="s2">=</span><span class="s3">'upper right'</span><span class="s2">)</span>

<span class="s0">plt</span><span class="s2">.</span><span class="s0">title</span><span class="s2">(</span><span class="s3">'Revenue and Profit MoM'</span><span class="s2">)</span>

<span class="s0">plt</span><span class="s2">.</span><span class="s0">show</span><span class="s2">()</span><hr class="ls0"><span class="s0">#%% md 
#### In Detail: Customer Segment <hr class="ls0">#%% md 
##### Sales, Profit, and Order Quantity by Customer Segment (2017) <hr class="ls0">#%% 
Segment_df </span><span class="s2">= </span><span class="s0">df_current_year</span><span class="s2">.</span><span class="s0">groupby</span><span class="s2">([</span><span class="s3">'Segment'</span><span class="s2">])[[</span><span class="s3">'Sales'</span><span class="s2">,</span><span class="s3">'Profit'</span><span class="s2">,</span><span class="s3">'Quantity'</span><span class="s2">]].</span><span class="s0">sum</span><span class="s2">().</span><span class="s0">sort_values</span><span class="s2">(</span><span class="s0">ascending</span><span class="s2">=</span><span class="s1">False</span><span class="s2">, </span><span class="s0">by</span><span class="s2">=</span><span class="s3">'Sales'</span><span class="s2">)</span>

<span class="s0">Segment_df</span><hr class="ls0"><span class="s0">#%% 
fig</span><span class="s2">, </span><span class="s0">axes </span><span class="s2">= </span><span class="s0">plt</span><span class="s2">.</span><span class="s0">subplots</span><span class="s2">(</span><span class="s5">1</span><span class="s2">,</span><span class="s5">3</span><span class="s2">, </span><span class="s0">figsize</span><span class="s2">=(</span><span class="s5">10</span><span class="s2">,</span><span class="s5">6</span><span class="s2">), </span><span class="s0">constrained_layout</span><span class="s2">=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s0">sns</span><span class="s2">.</span><span class="s0">barplot</span><span class="s2">(</span><span class="s0">data</span><span class="s2">=</span><span class="s0">Segment_df</span><span class="s2">, </span><span class="s0">x</span><span class="s2">=</span><span class="s0">Segment_df</span><span class="s2">.</span><span class="s0">index</span><span class="s2">, </span><span class="s0">y</span><span class="s2">=</span><span class="s3">'Sales'</span><span class="s2">, </span><span class="s0">hue</span><span class="s2">=</span><span class="s3">'Segment'</span><span class="s2">, </span><span class="s0">palette</span><span class="s2">=</span><span class="s3">'Set1'</span><span class="s2">, </span><span class="s0">ax</span><span class="s2">=</span><span class="s0">axes</span><span class="s2">[</span><span class="s5">0</span><span class="s2">])</span>
<span class="s0">sns</span><span class="s2">.</span><span class="s0">barplot</span><span class="s2">(</span><span class="s0">data</span><span class="s2">=</span><span class="s0">Segment_df</span><span class="s2">, </span><span class="s0">x</span><span class="s2">=</span><span class="s0">Segment_df</span><span class="s2">.</span><span class="s0">index</span><span class="s2">, </span><span class="s0">y</span><span class="s2">=</span><span class="s3">'Profit'</span><span class="s2">, </span><span class="s0">hue</span><span class="s2">=</span><span class="s3">'Segment'</span><span class="s2">, </span><span class="s0">palette</span><span class="s2">=</span><span class="s3">'Set1'</span><span class="s2">, </span><span class="s0">ax</span><span class="s2">=</span><span class="s0">axes</span><span class="s2">[</span><span class="s5">1</span><span class="s2">])</span>
<span class="s0">sns</span><span class="s2">.</span><span class="s0">barplot</span><span class="s2">(</span><span class="s0">data</span><span class="s2">=</span><span class="s0">Segment_df</span><span class="s2">, </span><span class="s0">x</span><span class="s2">=</span><span class="s0">Segment_df</span><span class="s2">.</span><span class="s0">index</span><span class="s2">, </span><span class="s0">y</span><span class="s2">=</span><span class="s3">'Quantity'</span><span class="s2">, </span><span class="s0">hue</span><span class="s2">=</span><span class="s3">'Segment'</span><span class="s2">, </span><span class="s0">palette</span><span class="s2">=</span><span class="s3">'Set1'</span><span class="s2">, </span><span class="s0">ax</span><span class="s2">=</span><span class="s0">axes</span><span class="s2">[</span><span class="s5">2</span><span class="s2">])</span>

<span class="s0">axes</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s0">set_title</span><span class="s2">(</span><span class="s3">'Revenue ($)'</span><span class="s2">)</span>
<span class="s0">axes</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s0">set_title</span><span class="s2">(</span><span class="s3">'Profit ($)'</span><span class="s2">)</span>
<span class="s0">axes</span><span class="s2">[</span><span class="s5">2</span><span class="s2">].</span><span class="s0">set_title</span><span class="s2">(</span><span class="s3">'Order Quantity'</span><span class="s2">)</span>

<span class="s1">for </span><span class="s0">ax </span><span class="s1">in </span><span class="s0">axes</span><span class="s2">:</span>
    <span class="s0">ax</span><span class="s2">.</span><span class="s0">tick_params</span><span class="s2">(</span><span class="s0">axis</span><span class="s2">=</span><span class="s3">'x'</span><span class="s2">, </span><span class="s0">labelrotation</span><span class="s2">=</span><span class="s5">45</span><span class="s2">)</span>

<span class="s1">for </span><span class="s0">ax </span><span class="s1">in </span><span class="s0">axes</span><span class="s2">:</span>
    <span class="s0">ax</span><span class="s2">.</span><span class="s0">yaxis</span><span class="s2">.</span><span class="s0">set_major_formatter</span><span class="s2">(</span><span class="s0">mtick</span><span class="s2">.</span><span class="s0">StrMethodFormatter</span><span class="s2">(</span><span class="s3">'{x:,.0f}'</span><span class="s2">))</span>

<span class="s1">for </span><span class="s0">ax </span><span class="s1">in </span><span class="s0">axes</span><span class="s2">:</span>
    <span class="s1">for </span><span class="s0">container </span><span class="s1">in </span><span class="s0">ax</span><span class="s2">.</span><span class="s0">containers</span><span class="s2">:</span>
        <span class="s1">if </span><span class="s0">len</span><span class="s2">(</span><span class="s0">container</span><span class="s2">) &gt; </span><span class="s5">0</span><span class="s2">:</span>
            <span class="s0">ax</span><span class="s2">.</span><span class="s0">bar_label</span><span class="s2">(</span><span class="s0">container</span><span class="s2">, </span><span class="s0">fmt</span><span class="s2">=</span><span class="s3">'{:,.0f}'</span><span class="s2">, </span><span class="s0">label_type</span><span class="s2">=</span><span class="s3">'edge'</span><span class="s2">, </span><span class="s0">fontsize</span><span class="s2">=</span><span class="s5">10</span><span class="s2">)</span>

<span class="s0">plt</span><span class="s2">.</span><span class="s0">show</span><span class="s2">()</span><hr class="ls0"><span class="s0">#%% md 
##### Product Sub-Category Profitability by Customer Segment (2017) <hr class="ls0">#%% 
Segment_Cat_Profits </span><span class="s2">= </span><span class="s0">pd</span><span class="s2">.</span><span class="s0">pivot_table</span><span class="s2">(</span><span class="s0">df_current_year</span><span class="s2">, </span><span class="s0">index</span><span class="s2">=</span><span class="s3">'Segment'</span><span class="s2">, </span><span class="s0">columns</span><span class="s2">=</span><span class="s3">'Sub-Category'</span><span class="s2">, </span><span class="s0">values</span><span class="s2">=</span><span class="s3">'Profit'</span><span class="s2">, </span><span class="s0">aggfunc</span><span class="s2">=</span><span class="s3">'sum'</span><span class="s2">)</span>
<span class="s0">Segment_Cat_Profits </span><span class="s2">= </span><span class="s0">Segment_Cat_Profits</span><span class="s2">.</span><span class="s0">sort_index</span><span class="s2">(</span><span class="s0">ascending</span><span class="s2">=</span><span class="s1">False</span><span class="s2">)</span>

<span class="s0">plt</span><span class="s2">.</span><span class="s0">figure</span><span class="s2">(</span><span class="s0">figsize </span><span class="s2">= (</span><span class="s5">10</span><span class="s2">,</span><span class="s5">4</span><span class="s2">))</span>
<span class="s0">sns</span><span class="s2">.</span><span class="s0">heatmap</span><span class="s2">(</span><span class="s0">Segment_Cat_Profits</span><span class="s2">, </span><span class="s0">cmap</span><span class="s2">=</span><span class="s3">'Blues'</span><span class="s2">)</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">tick_params</span><span class="s2">(</span><span class="s0">axis</span><span class="s2">=</span><span class="s3">'x'</span><span class="s2">, </span><span class="s0">labelrotation</span><span class="s2">=</span><span class="s5">45</span><span class="s2">)</span>

<span class="s0">plt</span><span class="s2">.</span><span class="s0">show</span><span class="s2">()</span><hr class="ls0"><span class="s0">#%% md 
#### In Detail: Product Sub-Category <hr class="ls0">#%% md 
##### Revenue and Profit by Product Sub-Category (2017) <hr class="ls0">#%% 
fig</span><span class="s2">, </span><span class="s0">axes </span><span class="s2">= </span><span class="s0">plt</span><span class="s2">.</span><span class="s0">subplots</span><span class="s2">(</span><span class="s5">1</span><span class="s2">,</span><span class="s5">3</span><span class="s2">,</span><span class="s0">figsize</span><span class="s2">=(</span><span class="s5">20</span><span class="s2">,</span><span class="s5">7</span><span class="s2">),</span><span class="s0">constrained_layout</span><span class="s2">=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s0">hue_order </span><span class="s2">= </span><span class="s0">df_current_year</span><span class="s2">[</span><span class="s3">'Sub-Category'</span><span class="s2">].</span><span class="s0">unique</span><span class="s2">()</span>

<span class="s0">category_sales </span><span class="s2">= </span><span class="s0">df_current_year</span><span class="s2">.</span><span class="s0">groupby</span><span class="s2">([</span><span class="s3">'Category'</span><span class="s2">,</span><span class="s3">'Sub-Category'</span><span class="s2">])[[</span><span class="s3">'Sales'</span><span class="s2">,</span><span class="s3">'Profit'</span><span class="s2">]].</span><span class="s0">sum</span><span class="s2">().</span><span class="s0">sort_values</span><span class="s2">(</span><span class="s0">by</span><span class="s2">=</span><span class="s3">'Sales'</span><span class="s2">, </span><span class="s0">ascending</span><span class="s2">=</span><span class="s1">False</span><span class="s2">).</span><span class="s0">reset_index</span><span class="s2">()</span>

<span class="s0">sns</span><span class="s2">.</span><span class="s0">barplot</span><span class="s2">(</span><span class="s0">data</span><span class="s2">=</span><span class="s0">category_sales</span><span class="s2">, </span><span class="s0">y</span><span class="s2">=</span><span class="s3">'Sub-Category'</span><span class="s2">, </span><span class="s0">x</span><span class="s2">=</span><span class="s3">'Sales'</span><span class="s2">, </span><span class="s0">ax</span><span class="s2">=</span><span class="s0">axes</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s0">hue</span><span class="s2">=</span><span class="s3">'Sub-Category'</span><span class="s2">, </span><span class="s0">hue_order</span><span class="s2">=</span><span class="s0">hue_order</span><span class="s2">, </span><span class="s0">palette</span><span class="s2">=</span><span class="s3">'Set1'</span><span class="s2">)</span>
<span class="s0">axes</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s0">set_title</span><span class="s2">(</span><span class="s3">'Revenue by Product Sub-Category'</span><span class="s2">)</span>
<span class="s0">axes</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s0">set_xlabel</span><span class="s2">(</span><span class="s3">'Revenue ($)'</span><span class="s2">)</span>


<span class="s0">category_profit </span><span class="s2">= </span><span class="s0">df_current_year</span><span class="s2">.</span><span class="s0">groupby</span><span class="s2">([</span><span class="s3">'Category'</span><span class="s2">,</span><span class="s3">'Sub-Category'</span><span class="s2">])[[</span><span class="s3">'Sales'</span><span class="s2">,</span><span class="s3">'Profit'</span><span class="s2">]].</span><span class="s0">sum</span><span class="s2">().</span><span class="s0">sort_values</span><span class="s2">(</span><span class="s0">by</span><span class="s2">=</span><span class="s3">'Profit'</span><span class="s2">, </span><span class="s0">ascending</span><span class="s2">=</span><span class="s1">False</span><span class="s2">).</span><span class="s0">reset_index</span><span class="s2">()</span>

<span class="s0">sns</span><span class="s2">.</span><span class="s0">barplot</span><span class="s2">(</span><span class="s0">data</span><span class="s2">=</span><span class="s0">category_profit</span><span class="s2">, </span><span class="s0">y</span><span class="s2">=</span><span class="s3">'Sub-Category'</span><span class="s2">, </span><span class="s0">x</span><span class="s2">=</span><span class="s3">'Profit'</span><span class="s2">, </span><span class="s0">ax</span><span class="s2">=</span><span class="s0">axes</span><span class="s2">[</span><span class="s5">1</span><span class="s2">], </span><span class="s0">hue</span><span class="s2">=</span><span class="s3">'Sub-Category'</span><span class="s2">, </span><span class="s0">hue_order</span><span class="s2">=</span><span class="s0">hue_order</span><span class="s2">, </span><span class="s0">palette</span><span class="s2">=</span><span class="s3">'Set1'</span><span class="s2">)</span>
<span class="s0">axes</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s0">set_title</span><span class="s2">(</span><span class="s3">'Profit by Product Sub-Category'</span><span class="s2">)</span>
<span class="s0">axes</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s0">set_xlabel</span><span class="s2">(</span><span class="s3">'Profit ($)'</span><span class="s2">)</span>

<span class="s0">category_orders </span><span class="s2">= </span><span class="s0">df_current_year</span><span class="s2">.</span><span class="s0">groupby</span><span class="s2">([</span><span class="s3">'Category'</span><span class="s2">,</span><span class="s3">'Sub-Category'</span><span class="s2">])[</span><span class="s3">'Order ID'</span><span class="s2">].</span><span class="s0">nunique</span><span class="s2">().</span><span class="s0">reset_index</span><span class="s2">()</span>

<span class="s0">category_orders </span><span class="s2">= </span><span class="s0">category_orders</span><span class="s2">.</span><span class="s0">sort_values</span><span class="s2">(</span><span class="s0">by</span><span class="s2">=</span><span class="s3">'Order ID'</span><span class="s2">, </span><span class="s0">ascending</span><span class="s2">=</span><span class="s1">False</span><span class="s2">)</span>
<span class="s0">sns</span><span class="s2">.</span><span class="s0">barplot</span><span class="s2">(</span><span class="s0">data</span><span class="s2">=</span><span class="s0">category_orders</span><span class="s2">, </span><span class="s0">x</span><span class="s2">=</span><span class="s3">'Order ID'</span><span class="s2">, </span><span class="s0">y</span><span class="s2">=</span><span class="s3">'Sub-Category'</span><span class="s2">, </span><span class="s0">ax</span><span class="s2">=</span><span class="s0">axes</span><span class="s2">[</span><span class="s5">2</span><span class="s2">], </span><span class="s0">hue</span><span class="s2">=</span><span class="s3">'Sub-Category'</span><span class="s2">, </span><span class="s0">hue_order</span><span class="s2">=</span><span class="s0">hue_order</span><span class="s2">, </span><span class="s0">palette</span><span class="s2">=</span><span class="s3">'Set1'</span><span class="s2">)</span>
<span class="s0">axes</span><span class="s2">[</span><span class="s5">2</span><span class="s2">].</span><span class="s0">set_title</span><span class="s2">(</span><span class="s3">'Order Count by Sub-Category'</span><span class="s2">)</span>
<span class="s0">axes</span><span class="s2">[</span><span class="s5">2</span><span class="s2">].</span><span class="s0">set_xlabel</span><span class="s2">(</span><span class="s3">'Order Count'</span><span class="s2">)</span>

<span class="s1">for </span><span class="s0">ax </span><span class="s1">in </span><span class="s0">axes</span><span class="s2">:</span>
    <span class="s0">ax</span><span class="s2">.</span><span class="s0">tick_params</span><span class="s2">(</span><span class="s0">axis</span><span class="s2">=</span><span class="s3">'x'</span><span class="s2">, </span><span class="s0">rotation</span><span class="s2">=</span><span class="s5">45</span><span class="s2">, </span><span class="s0">labelsize</span><span class="s2">=</span><span class="s5">10</span><span class="s2">)</span>

<span class="s0">plt</span><span class="s2">.</span><span class="s0">show</span><span class="s2">()</span><hr class="ls0"><span class="s0">#%% md 
##### Sub-Category Revenue vs Profit (2017) <hr class="ls0">#%% 
</span><span class="s4"># Using same y axes; note that negative values get clipped</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">figure</span><span class="s2">(</span><span class="s0">figsize</span><span class="s2">=(</span><span class="s5">10</span><span class="s2">,</span><span class="s5">6</span><span class="s2">))</span>
<span class="s0">ax </span><span class="s2">= </span><span class="s0">plt</span><span class="s2">.</span><span class="s0">gca</span><span class="s2">()</span>

<span class="s4">#Revenue</span>
<span class="s0">sns</span><span class="s2">.</span><span class="s0">barplot</span><span class="s2">(</span><span class="s0">data</span><span class="s2">=</span><span class="s0">category_sales</span><span class="s2">, </span><span class="s0">x</span><span class="s2">=</span><span class="s3">'Sub-Category'</span><span class="s2">, </span><span class="s0">y</span><span class="s2">=</span><span class="s3">'Sales'</span><span class="s2">, </span><span class="s0">ax</span><span class="s2">=</span><span class="s0">ax</span><span class="s2">, </span><span class="s0">label</span><span class="s2">=</span><span class="s3">'Revenue'</span><span class="s2">)</span>

<span class="s4">#Profit</span>
<span class="s0">sns</span><span class="s2">.</span><span class="s0">lineplot</span><span class="s2">(</span><span class="s0">data</span><span class="s2">=</span><span class="s0">category_sales</span><span class="s2">, </span><span class="s0">x</span><span class="s2">=</span><span class="s3">'Sub-Category'</span><span class="s2">, </span><span class="s0">y</span><span class="s2">=</span><span class="s3">'Profit'</span><span class="s2">, </span><span class="s0">color</span><span class="s2">=</span><span class="s3">'red'</span><span class="s2">, </span><span class="s0">marker</span><span class="s2">=</span><span class="s3">'o'</span><span class="s2">, </span><span class="s0">ax</span><span class="s2">=</span><span class="s0">ax</span><span class="s2">, </span><span class="s0">label</span><span class="s2">=</span><span class="s3">'Profit'</span><span class="s2">)</span>

<span class="s0">ax</span><span class="s2">.</span><span class="s0">tick_params</span><span class="s2">(</span><span class="s0">axis</span><span class="s2">=</span><span class="s3">'x'</span><span class="s2">, </span><span class="s0">rotation</span><span class="s2">=</span><span class="s5">45</span><span class="s2">, </span><span class="s0">labelsize</span><span class="s2">=</span><span class="s5">8</span><span class="s2">)</span>
<span class="s0">ax</span><span class="s2">.</span><span class="s0">set_ylabel</span><span class="s2">(</span><span class="s3">'Revenue'</span><span class="s2">)</span>

<span class="s0">plt</span><span class="s2">.</span><span class="s0">show</span><span class="s2">()</span><hr class="ls0"><span class="s0">#%% 
</span><span class="s4"># Using different y axes</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">figure</span><span class="s2">(</span><span class="s0">figsize</span><span class="s2">=(</span><span class="s5">10</span><span class="s2">,</span><span class="s5">6</span><span class="s2">))</span>
<span class="s0">sns</span><span class="s2">.</span><span class="s0">barplot</span><span class="s2">(</span><span class="s0">data</span><span class="s2">=</span><span class="s0">category_sales</span><span class="s2">, </span><span class="s0">x</span><span class="s2">=</span><span class="s3">'Sub-Category'</span><span class="s2">, </span><span class="s0">y</span><span class="s2">=</span><span class="s3">'Sales'</span><span class="s2">, </span><span class="s0">color</span><span class="s2">=</span><span class="s3">'skyblue'</span><span class="s2">, </span><span class="s0">label</span><span class="s2">=</span><span class="s3">'Revenue'</span><span class="s2">)</span>

<span class="s0">ax1 </span><span class="s2">= </span><span class="s0">plt</span><span class="s2">.</span><span class="s0">gca</span><span class="s2">()</span>
<span class="s0">ax2 </span><span class="s2">= </span><span class="s0">ax1</span><span class="s2">.</span><span class="s0">twinx</span><span class="s2">()</span>

<span class="s0">sns</span><span class="s2">.</span><span class="s0">lineplot</span><span class="s2">(</span><span class="s0">data</span><span class="s2">=</span><span class="s0">category_sales</span><span class="s2">, </span><span class="s0">x</span><span class="s2">=</span><span class="s3">'Sub-Category'</span><span class="s2">, </span><span class="s0">y</span><span class="s2">=</span><span class="s3">'Profit'</span><span class="s2">, </span><span class="s0">color</span><span class="s2">=</span><span class="s3">'red'</span><span class="s2">, </span><span class="s0">marker</span><span class="s2">=</span><span class="s3">'o'</span><span class="s2">, </span><span class="s0">label</span><span class="s2">=</span><span class="s3">'Profit'</span><span class="s2">, </span><span class="s0">ax</span><span class="s2">=</span><span class="s0">ax2</span><span class="s2">)</span>

<span class="s4"># Formatting</span>
<span class="s0">ax1</span><span class="s2">.</span><span class="s0">set_ylabel</span><span class="s2">(</span><span class="s3">'Sales'</span><span class="s2">, </span><span class="s0">color</span><span class="s2">=</span><span class="s3">'skyblue'</span><span class="s2">)</span>
<span class="s0">ax2</span><span class="s2">.</span><span class="s0">set_ylabel</span><span class="s2">(</span><span class="s3">'Profit'</span><span class="s2">, </span><span class="s0">color</span><span class="s2">=</span><span class="s3">'red'</span><span class="s2">)</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">title</span><span class="s2">(</span><span class="s3">'Sales vs Profit by Product Sub-Category'</span><span class="s2">)</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">legend</span><span class="s2">(</span><span class="s0">bbox_to_anchor</span><span class="s2">=(</span><span class="s5">0.86</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">))</span>
<span class="s0">ax1</span><span class="s2">.</span><span class="s0">tick_params</span><span class="s2">(</span><span class="s0">axis</span><span class="s2">=</span><span class="s3">'x'</span><span class="s2">, </span><span class="s0">rotation</span><span class="s2">=</span><span class="s5">45</span><span class="s2">, </span><span class="s0">labelsize</span><span class="s2">=</span><span class="s5">8</span><span class="s2">)</span>

<span class="s0">plt</span><span class="s2">.</span><span class="s0">tight_layout</span><span class="s2">()</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">show</span><span class="s2">()</span><hr class="ls0"><span class="s0">#%% md 
#### In Detail: Region <hr class="ls0">#%% md 
##### Sales, Profit, and Order Quantity by Region (2017) <hr class="ls0">#%% 
Region_df </span><span class="s2">= </span><span class="s0">df_current_year</span><span class="s2">.</span><span class="s0">groupby</span><span class="s2">([</span><span class="s3">'Region'</span><span class="s2">])[[</span><span class="s3">'Sales'</span><span class="s2">,</span><span class="s3">'Profit'</span><span class="s2">,</span><span class="s3">'Quantity'</span><span class="s2">]].</span><span class="s0">sum</span><span class="s2">().</span><span class="s0">sort_values</span><span class="s2">(</span><span class="s0">ascending</span><span class="s2">=</span><span class="s1">False</span><span class="s2">, </span><span class="s0">by</span><span class="s2">=</span><span class="s3">'Sales'</span><span class="s2">)</span>

<span class="s0">Region_df</span><hr class="ls0"><span class="s0">#%% 
fig</span><span class="s2">, </span><span class="s0">axes </span><span class="s2">= </span><span class="s0">plt</span><span class="s2">.</span><span class="s0">subplots</span><span class="s2">(</span><span class="s5">1</span><span class="s2">,</span><span class="s5">3</span><span class="s2">, </span><span class="s0">figsize</span><span class="s2">=(</span><span class="s5">10</span><span class="s2">,</span><span class="s5">6</span><span class="s2">), </span><span class="s0">constrained_layout</span><span class="s2">=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s0">sns</span><span class="s2">.</span><span class="s0">barplot</span><span class="s2">(</span><span class="s0">data</span><span class="s2">=</span><span class="s0">Region_df</span><span class="s2">, </span><span class="s0">x</span><span class="s2">=</span><span class="s0">Region_df</span><span class="s2">.</span><span class="s0">index</span><span class="s2">, </span><span class="s0">y</span><span class="s2">=</span><span class="s3">'Sales'</span><span class="s2">, </span><span class="s0">hue</span><span class="s2">=</span><span class="s3">'Region'</span><span class="s2">, </span><span class="s0">palette</span><span class="s2">=</span><span class="s3">'Set1'</span><span class="s2">, </span><span class="s0">ax</span><span class="s2">=</span><span class="s0">axes</span><span class="s2">[</span><span class="s5">0</span><span class="s2">])</span>
<span class="s0">sns</span><span class="s2">.</span><span class="s0">barplot</span><span class="s2">(</span><span class="s0">data</span><span class="s2">=</span><span class="s0">Region_df</span><span class="s2">, </span><span class="s0">x</span><span class="s2">=</span><span class="s0">Region_df</span><span class="s2">.</span><span class="s0">index</span><span class="s2">, </span><span class="s0">y</span><span class="s2">=</span><span class="s3">'Profit'</span><span class="s2">, </span><span class="s0">hue</span><span class="s2">=</span><span class="s3">'Region'</span><span class="s2">, </span><span class="s0">palette</span><span class="s2">=</span><span class="s3">'Set1'</span><span class="s2">, </span><span class="s0">ax</span><span class="s2">=</span><span class="s0">axes</span><span class="s2">[</span><span class="s5">1</span><span class="s2">])</span>
<span class="s0">sns</span><span class="s2">.</span><span class="s0">barplot</span><span class="s2">(</span><span class="s0">data</span><span class="s2">=</span><span class="s0">Region_df</span><span class="s2">, </span><span class="s0">x</span><span class="s2">=</span><span class="s0">Region_df</span><span class="s2">.</span><span class="s0">index</span><span class="s2">, </span><span class="s0">y</span><span class="s2">=</span><span class="s3">'Quantity'</span><span class="s2">, </span><span class="s0">hue</span><span class="s2">=</span><span class="s3">'Region'</span><span class="s2">, </span><span class="s0">palette</span><span class="s2">=</span><span class="s3">'Set1'</span><span class="s2">, </span><span class="s0">ax</span><span class="s2">=</span><span class="s0">axes</span><span class="s2">[</span><span class="s5">2</span><span class="s2">])</span>

<span class="s0">axes</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s0">set_title</span><span class="s2">(</span><span class="s3">'Revenue ($)'</span><span class="s2">)</span>
<span class="s0">axes</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s0">set_title</span><span class="s2">(</span><span class="s3">'Profit ($)'</span><span class="s2">)</span>
<span class="s0">axes</span><span class="s2">[</span><span class="s5">2</span><span class="s2">].</span><span class="s0">set_title</span><span class="s2">(</span><span class="s3">'Order Quantity'</span><span class="s2">)</span>

<span class="s1">for </span><span class="s0">ax </span><span class="s1">in </span><span class="s0">axes</span><span class="s2">:</span>
    <span class="s0">ax</span><span class="s2">.</span><span class="s0">tick_params</span><span class="s2">(</span><span class="s0">axis</span><span class="s2">=</span><span class="s3">'x'</span><span class="s2">, </span><span class="s0">labelrotation</span><span class="s2">=</span><span class="s5">45</span><span class="s2">)</span>

<span class="s1">for </span><span class="s0">ax </span><span class="s1">in </span><span class="s0">axes</span><span class="s2">:</span>
    <span class="s0">ax</span><span class="s2">.</span><span class="s0">yaxis</span><span class="s2">.</span><span class="s0">set_major_formatter</span><span class="s2">(</span><span class="s0">mtick</span><span class="s2">.</span><span class="s0">StrMethodFormatter</span><span class="s2">(</span><span class="s3">'{x:,.0f}'</span><span class="s2">))</span>

<span class="s1">for </span><span class="s0">ax </span><span class="s1">in </span><span class="s0">axes</span><span class="s2">:</span>
    <span class="s1">for </span><span class="s0">container </span><span class="s1">in </span><span class="s0">ax</span><span class="s2">.</span><span class="s0">containers</span><span class="s2">:</span>
        <span class="s1">if </span><span class="s0">len</span><span class="s2">(</span><span class="s0">container</span><span class="s2">) &gt; </span><span class="s5">0</span><span class="s2">:</span>
            <span class="s0">ax</span><span class="s2">.</span><span class="s0">bar_label</span><span class="s2">(</span><span class="s0">container</span><span class="s2">, </span><span class="s0">fmt</span><span class="s2">=</span><span class="s3">'{:,.0f}'</span><span class="s2">, </span><span class="s0">label_type</span><span class="s2">=</span><span class="s3">'edge'</span><span class="s2">, </span><span class="s0">fontsize</span><span class="s2">=</span><span class="s5">10</span><span class="s2">)</span>

<span class="s0">plt</span><span class="s2">.</span><span class="s0">show</span><span class="s2">()</span><hr class="ls0"><span class="s0">#%% md 
##### Profit by Region (2017) <hr class="ls0">#%% 
Region_Profit </span><span class="s2">= </span><span class="s0">pd</span><span class="s2">.</span><span class="s0">pivot_table</span><span class="s2">(</span><span class="s0">df_current_year</span><span class="s2">, </span><span class="s0">columns</span><span class="s2">=</span><span class="s3">'Sub-Category'</span><span class="s2">, </span><span class="s0">index</span><span class="s2">=</span><span class="s3">'Region'</span><span class="s2">, </span><span class="s0">values</span><span class="s2">=</span><span class="s3">'Profit'</span><span class="s2">, </span><span class="s0">aggfunc</span><span class="s2">=</span><span class="s3">'sum'</span><span class="s2">)</span>

<span class="s0">plt</span><span class="s2">.</span><span class="s0">figure</span><span class="s2">(</span><span class="s0">figsize</span><span class="s2">=(</span><span class="s5">10</span><span class="s2">,</span><span class="s5">6</span><span class="s2">))</span>
<span class="s0">sns</span><span class="s2">.</span><span class="s0">heatmap</span><span class="s2">(</span><span class="s0">data</span><span class="s2">=</span><span class="s0">Region_Profit</span><span class="s2">,</span><span class="s0">cmap</span><span class="s2">=</span><span class="s3">'Blues'</span><span class="s2">)</span>

<span class="s0">plt</span><span class="s2">.</span><span class="s0">title</span><span class="s2">(</span><span class="s3">'Sub-Category Profit Heatmap by Geographic Region'</span><span class="s2">)</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">tick_params</span><span class="s2">(</span><span class="s0">axis</span><span class="s2">=</span><span class="s3">'x'</span><span class="s2">, </span><span class="s0">rotation</span><span class="s2">=</span><span class="s5">45</span><span class="s2">, </span><span class="s0">labelsize</span><span class="s2">=</span><span class="s5">9</span><span class="s2">)</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">tight_layout</span><span class="s2">()</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">show</span><span class="s2">()</span><hr class="ls0"><span class="s0">#%% md 
##### Order Count by Region (2017) <hr class="ls0">#%% 
Region_Orders </span><span class="s2">= </span><span class="s0">pd</span><span class="s2">.</span><span class="s0">pivot_table</span><span class="s2">(</span><span class="s0">df_current_year</span><span class="s2">, </span><span class="s0">columns</span><span class="s2">=</span><span class="s3">'Sub-Category'</span><span class="s2">, </span><span class="s0">index</span><span class="s2">=</span><span class="s3">'Region'</span><span class="s2">, </span><span class="s0">values</span><span class="s2">=</span><span class="s3">'Order ID'</span><span class="s2">, </span><span class="s0">aggfunc</span><span class="s2">=</span><span class="s3">'nunique'</span><span class="s2">)</span>

<span class="s0">plt</span><span class="s2">.</span><span class="s0">figure</span><span class="s2">(</span><span class="s0">figsize</span><span class="s2">=(</span><span class="s5">10</span><span class="s2">,</span><span class="s5">6</span><span class="s2">))</span>
<span class="s0">sns</span><span class="s2">.</span><span class="s0">heatmap</span><span class="s2">(</span><span class="s0">data</span><span class="s2">=</span><span class="s0">Region_Orders</span><span class="s2">,</span><span class="s0">cmap</span><span class="s2">=</span><span class="s3">'Blues'</span><span class="s2">)</span>

<span class="s0">plt</span><span class="s2">.</span><span class="s0">title</span><span class="s2">(</span><span class="s3">'Sub-Category Order Count Heatmap by Geographic Region'</span><span class="s2">)</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">tick_params</span><span class="s2">(</span><span class="s0">axis</span><span class="s2">=</span><span class="s3">'x'</span><span class="s2">, </span><span class="s0">rotation</span><span class="s2">=</span><span class="s5">45</span><span class="s2">, </span><span class="s0">labelsize</span><span class="s2">=</span><span class="s5">9</span><span class="s2">)</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">tight_layout</span><span class="s2">()</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">show</span><span class="s2">()</span><hr class="ls0"><span class="s0">#%% md 
##### Top 10 Most Profitable States (2017) <hr class="ls0">#%% 
State_Sales </span><span class="s2">= </span><span class="s0">df_current_year</span><span class="s2">.</span><span class="s0">groupby</span><span class="s2">([</span><span class="s3">'Region'</span><span class="s2">,</span><span class="s3">'State'</span><span class="s2">])[[</span><span class="s3">'Sales'</span><span class="s2">,</span><span class="s3">'Profit'</span><span class="s2">]].</span><span class="s0">sum</span><span class="s2">().</span><span class="s0">sort_values</span><span class="s2">(</span><span class="s0">by</span><span class="s2">=</span><span class="s3">'Profit'</span><span class="s2">,</span><span class="s0">ascending</span><span class="s2">=</span><span class="s1">False</span><span class="s2">).</span><span class="s0">reset_index</span><span class="s2">()</span>

<span class="s0">State_Sales</span><span class="s2">.</span><span class="s0">head</span><span class="s2">(</span><span class="s5">10</span><span class="s2">)</span><hr class="ls0"><span class="s0">#%% md 
##### Top 10 Order Quantities by State <hr class="ls0">#%% 
State_Order_Count </span><span class="s2">= </span><span class="s0">df_current_year</span><span class="s2">.</span><span class="s0">groupby</span><span class="s2">(</span><span class="s3">'State'</span><span class="s2">)[[</span><span class="s3">'Order ID'</span><span class="s2">]].</span><span class="s0">nunique</span><span class="s2">()</span>

<span class="s0">State_Order_Count</span><span class="s2">.</span><span class="s0">sort_values</span><span class="s2">(</span><span class="s0">by</span><span class="s2">=</span><span class="s3">'Order ID'</span><span class="s2">, </span><span class="s0">ascending</span><span class="s2">=</span><span class="s1">False</span><span class="s2">).</span><span class="s0">head</span><span class="s2">(</span><span class="s5">10</span><span class="s2">)</span><hr class="ls0"><span class="s0">#%% md 
###### Deep Dive: Which Products are the Top 10 Profit States buying? <hr class="ls0">#%% 
Top_Profit_States </span><span class="s2">= </span><span class="s0">State_Sales</span><span class="s2">.</span><span class="s0">State</span><span class="s2">.</span><span class="s0">head</span><span class="s2">(</span><span class="s5">10</span><span class="s2">).</span><span class="s0">to_list</span><span class="s2">()</span>

<span class="s0">Top_Profit_State_Subcats </span><span class="s2">= </span><span class="s0">pd</span><span class="s2">.</span><span class="s0">pivot_table</span><span class="s2">(</span><span class="s0">df_current_year</span><span class="s2">[</span><span class="s0">df_current_year</span><span class="s2">[</span><span class="s3">'State'</span><span class="s2">].</span><span class="s0">isin</span><span class="s2">(</span><span class="s0">Top_Profit_States</span><span class="s2">)], </span><span class="s0">index</span><span class="s2">=</span><span class="s3">'State'</span><span class="s2">, </span><span class="s0">columns</span><span class="s2">=</span><span class="s3">'Sub-Category'</span><span class="s2">, </span><span class="s0">values</span><span class="s2">=</span><span class="s3">'Profit'</span><span class="s2">, </span><span class="s0">aggfunc</span><span class="s2">=</span><span class="s3">'sum'</span><span class="s2">)</span>

<span class="s4">#Replace null values (no sales) with 0</span>
<span class="s0">Top_Profit_State_Subcats</span><span class="s2">.</span><span class="s0">fillna</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s0">inplace</span><span class="s2">=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s4">#Ensure df states are in order of profit for heatmap</span>
<span class="s0">Top_Profit_State_Subcats </span><span class="s2">= </span><span class="s0">Top_Profit_State_Subcats</span><span class="s2">.</span><span class="s0">reindex</span><span class="s2">(</span><span class="s0">Top_Profit_States</span><span class="s2">)</span>

<span class="s0">plt</span><span class="s2">.</span><span class="s0">figure</span><span class="s2">(</span><span class="s0">figsize</span><span class="s2">=(</span><span class="s5">10</span><span class="s2">,</span><span class="s5">6</span><span class="s2">))</span>
<span class="s0">sns</span><span class="s2">.</span><span class="s0">heatmap</span><span class="s2">(</span><span class="s0">Top_Profit_State_Subcats</span><span class="s2">, </span><span class="s0">cmap</span><span class="s2">=</span><span class="s3">'Blues'</span><span class="s2">)</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">title</span><span class="s2">(</span><span class="s3">'Product Profit Contribution in Top 10 Most Profitable States (2017)'</span><span class="s2">)</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">tight_layout</span><span class="s2">()</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">tick_params</span><span class="s2">(</span><span class="s0">axis</span><span class="s2">=</span><span class="s3">'x'</span><span class="s2">, </span><span class="s0">rotation</span><span class="s2">=</span><span class="s5">45</span><span class="s2">, </span><span class="s0">labelsize</span><span class="s2">=</span><span class="s5">9</span><span class="s2">)</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">show</span><span class="s2">()</span><hr class="ls0"><span class="s0">#%% md 
Possible further analyses 
1. Which items are typically discounted? Which tend to result in a loss? (loss leaders?) 
2. Are there certain products that are only purchased when discounted? Which products see the least and the most price elasticity? (do we want to conduct A/B price testing, or test features that increase value perception?) 
3. Which products tend to have repeat customers (Offer a subscription) 
4. Which products tend to be purchased together (Offer a bundle deal) 
5. Order to ship dates for various ship modes</span></pre>
</body>
</html>